<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meneige Boekhouding</title>

<!-- Google Fonts & Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Content Security Policy -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  font-src 'self' https://fonts.gstatic.com data:;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  script-src 'self' https://www.gstatic.com;
  connect-src 'self' https://*.firebaseio.com https://*.googleapis.com;
">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#dbeafe,#f0f9ff);
  min-height:100vh;
  transition:.4s;
}
body.dark{background:linear-gradient(135deg,#020617,#020617);color:white;}
header{text-align:center;padding:20px;}
#saldoCard{background:white;margin:20px auto;max-width:360px;padding:20px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,.1);}
body.dark #saldoCard{background:#020617}
#saldo{font-size:32px;font-weight:600;}
.actions{display:flex;gap:12px;justify-content:center;}
.btn{padding:14px;border-radius:14px;border:none;font-size:16px;cursor:pointer;}
.add{background:#60a5fa;color:white}
.cal{background:#e0f2fe}
#calendar{max-width:380px;margin:30px auto;display:grid;grid-template-columns:repeat(7,1fr);gap:6px;}
.day{background:white;padding:10px;border-radius:12px;text-align:center;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.08);}
body.dark .day{background:#020617}
.day.has{border:2px solid #60a5fa}

#modal,#dayModal,#budgetModal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;}
.box{background:white;width:90%;max-width:360px;padding:20px;border-radius:20px;}
body.dark .box{background:#020617}

input,select{width:100%;padding:10px;margin-top:8px;border-radius:10px;border:1px solid #cbd5f5;}

.themeToggle{position:fixed;top:15px;right:15px;font-size:22px;cursor:pointer;}
.entry{display:flex;justify-content:space-between;padding:6px 0;}
.pos{color:#22c55e}
.neg{color:#ef4444}
</style>
</head>

<body>

<div class="themeToggle" id="themeToggle">üåô</div>

<header><h1>Meneige Boekhouding</h1></header>

<div id="saldoCard">
  <p>Huidig saldo</p>
  <div id="saldo">‚Ç¨ 0,00</div>
</div>

<div id="budgetCard" style="max-width:360px;margin:10px auto;background:white;padding:16px;border-radius:18px;box-shadow:0 6px 18px rgba(0,0,0,.1);">
  <p>Maandelijks budget</p>
  <strong id="budgetAmount">Niet ingesteld</strong><br><br>
  <button class="btn btn-view" id="budgetBtn">‚öôÔ∏è Budget instellen</button>
</div>

<div id="budgetWarning" style="display:none;max-width:360px;margin:10px auto;padding:14px;border-radius:14px;text-align:center;font-weight:500;"></div>

<div class="actions">
  <button class="btn add" id="addBtn">‚ûï Toevoegen</button>
  <button class="btn cal" id="calBtn">üìÖ Kalender</button>
</div>

<div id="calendar"></div>

<!-- MODAL TOEVOEGEN -->
<div id="modal">
  <div class="box">
    <h3>Nieuwe beweging</h3>
    <select id="soort">
      <option value="inkomst">üí∞ Inkomst</option>
      <option value="uitgave">üí∏ Uitgave</option>
    </select>
    <input id="bron" placeholder="Van / Naar">
    <input type="date" id="datum">
    <input type="number" id="bedrag" placeholder="Bedrag">
    <label><input type="checkbox" id="recurring"> Maandelijks</label>
    <br><br>
    <button class="btn add" id="saveEntryBtn">Opslaan</button>
    <button class="btn" id="closeModalBtn">Annuleren</button>
  </div>
</div>

<!-- DAGDETAIL -->
<div id="dayModal">
  <div class="box">
    <h3 id="dayTitle"></h3>
    <div id="dayList"></div>
    <button class="btn" id="closeDayBtn">Sluiten</button>
  </div>
</div>

<!-- BUDGET MODAL -->
<div id="budgetModal">
  <div class="box">
    <h2>Maandelijks budget</h2>
    <input type="number" id="budgetInput" placeholder="Bijv. 1500">
    <br><br>
    <button class="btn save" id="saveBudgetBtn">Opslaan</button>
    <button class="btn cancel" id="closeBudgetBtn">Annuleren</button>
  </div>
</div>

<!-- ------------------- SCRIPT ------------------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import * as appFunctions from "./script.js";

const firebaseConfig = {
  apiKey: "AIzaSyAkBAw17gNU_EBhn8dKgyY5qv-ecfWaG2s",
  authDomain: "finance-jonas.firebaseapp.com",
  projectId: "finance-jonas",
  storageBucket: "finance-jonas.firebasestorage.app",
  messagingSenderId: "497182804753",
  appId: "1:497182804753:web:ea942a578dd1c15f631ab0",
  measurementId: "G-0J29T1Z7MV"
};

const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);
const db = getFirestore(firebaseApp);
window.db = db;

const provider = new GoogleAuthProvider();

// --- LOGIN MET GOOGLE ---
const login = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    window.user = result.user;
    appFunctions.loadData();
  } catch(e) {
    console.error(e);
    alert("Login mislukt!");
  }
};

onAuthStateChanged(auth, (user) => {
  if(!user){
    login();
  } else {
    window.user = user;
    appFunctions.loadData();
  }
});

// --- Event Listeners ---
document.getElementById("addBtn").addEventListener("click", appFunctions.openModal);
document.getElementById("closeModalBtn").addEventListener("click", appFunctions.closeModal);
document.getElementById("saveEntryBtn").addEventListener("click", appFunctions.saveEntry);
document.getElementById("calBtn").addEventListener("click", appFunctions.buildCalendar);
document.getElementById("budgetBtn").addEventListener("click", appFunctions.openBudget);
document.getElementById("closeBudgetBtn").addEventListener("click", appFunctions.closeBudget);
document.getElementById("saveBudgetBtn").addEventListener("click", appFunctions.saveBudget);
document.getElementById("themeToggle").addEventListener("click", appFunctions.toggleTheme);
</script>

</body>
</html>
